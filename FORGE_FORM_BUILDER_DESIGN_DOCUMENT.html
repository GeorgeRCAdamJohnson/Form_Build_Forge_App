<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forge Form Builder - Complete Design Document</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #1e293b;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 60px;
            padding: 40px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 20px;
            color: white;
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
        }
        
        .header h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            text-decoration: none;
            color: #64748b;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .nav-btn:hover {
            border-color: #6366f1;
            color: #6366f1;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        }
        
        .section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }
        
        .section h2 {
            color: #6366f1;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section h3 {
            color: #1e293b;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 30px 0 15px 0;
            border-left: 4px solid #6366f1;
            padding-left: 16px;
        }
        
        .section h4 {
            color: #475569;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 20px 0 10px 0;
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
            border: 1px solid #334155;
        }
        
        .highlight {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #f59e0b;
            margin: 20px 0;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .feature-card h4 {
            color: #6366f1;
            margin-bottom: 10px;
        }
        
        .architecture-diagram {
            background: #f8fafc;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
            border: 2px dashed #cbd5e1;
        }
        
        .flow-step {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            display: inline-block;
            margin: 5px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 20px 0;
        }
        
        .tech-item {
            background: #6366f1;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .status-complete {
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-progress {
            background: #f59e0b;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .toc {
            background: #f8fafc;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .toc ul {
            list-style: none;
            padding-left: 20px;
        }
        
        .toc li {
            margin: 8px 0;
        }
        
        .toc a {
            color: #6366f1;
            text-decoration: none;
            font-weight: 500;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        .warning {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-left: 4px solid #ef4444;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .warning h4 {
            color: #dc2626;
            margin-bottom: 8px;
        }
        
        .success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-left: 4px solid #10b981;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .success h4 {
            color: #059669;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Forge Form Builder</h1>
            <p>Complete Design & Implementation Guide</p>
        </div>
        
        <nav class="nav">
            <a href="#overview" class="nav-btn">ğŸ“‹ Overview</a>
            <a href="#architecture" class="nav-btn">ğŸ—ï¸ Architecture</a>
            <a href="#features" class="nav-btn">âœ¨ Features</a>
            <a href="#implementation" class="nav-btn">ğŸ’» Implementation</a>
            <a href="#deployment" class="nav-btn">ğŸš€ Deployment</a>
            <a href="#troubleshooting" class="nav-btn">ğŸ”§ Troubleshooting</a>
        </nav>
        
        <div class="toc">
            <h3>ğŸ“š Table of Contents</h3>
            <ul>
                <li><a href="#overview">1. Project Overview</a></li>
                <li><a href="#architecture">2. System Architecture</a></li>
                <li><a href="#features">3. Feature Documentation</a></li>
                <li><a href="#implementation">4. Implementation Guide</a></li>
                <li><a href="#deployment">5. Deployment Process</a></li>
                <li><a href="#troubleshooting">6. Troubleshooting Guide</a></li>
                <li><a href="#lessons">7. Lessons Learned</a></li>
            </ul>
        </div>
        
        <section id="overview" class="section">
            <h2>ğŸ“‹ Project Overview</h2>
            
            <div class="highlight">
                <h4>ğŸ¯ Mission Statement</h4>
                <p>Create a powerful, theme-enabled Atlassian Forge app that enables dynamic form creation and seamless Jira issue generation with advanced features like conditional logic, field validation, and intuitive drag-and-drop form building.</p>
            </div>
            
            <h3>ğŸš€ Key Achievements</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>âœ… Dynamic Form Builder</h4>
                    <p>Drag-and-drop interface with 90+ Jira fields, conditional logic, and real-time validation.</p>
                    <span class="status-complete">COMPLETE</span>
                </div>
                <div class="feature-card">
                    <h4>âœ… Three-Theme System</h4>
                    <p>Ultra Modern, Sci-Fi Cyber, and Barbie Dream themes with complete UI consistency.</p>
                    <span class="status-complete">COMPLETE</span>
                </div>
                <div class="feature-card">
                    <h4>âœ… Jira Integration</h4>
                    <p>Real-time field discovery, project context, and actual issue creation with proper formatting.</p>
                    <span class="status-complete">COMPLETE</span>
                </div>
                <div class="feature-card">
                    <h4>ğŸ”„ Enhanced Validation</h4>
                    <p>Real-time field validation with custom patterns and error messaging.</p>
                    <span class="status-progress">V3 ENHANCED</span>
                </div>
            </div>
            
            <h3>ğŸ› ï¸ Technology Stack</h3>
            <div class="tech-stack">
                <span class="tech-item">React 18</span>
                <span class="tech-item">Atlassian Forge</span>
                <span class="tech-item">Custom UI (No UI Kit)</span>
                <span class="tech-item">@dnd-kit/core</span>
                <span class="tech-item">Forge Storage API</span>
                <span class="tech-item">Webpack</span>
                <span class="tech-item">Babel</span>
            </div>
        </section>
        
        <section id="architecture" class="section">
            <h2>ğŸ—ï¸ System Architecture</h2>
            
            <div class="architecture-diagram">
                <h3>ğŸ“Š Component Architecture</h3>
                <div style="margin: 20px 0;">
                    <div class="flow-step">Frontend (React)</div>
                    <div class="flow-step">â†”ï¸</div>
                    <div class="flow-step">Forge Bridge</div>
                    <div class="flow-step">â†”ï¸</div>
                    <div class="flow-step">Resolvers</div>
                    <div class="flow-step">â†”ï¸</div>
                    <div class="flow-step">Jira API</div>
                </div>
            </div>
            
            <h3>ğŸ“ Project Structure</h3>
            <div class="code-block">
formbuilder/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ frontend/              # React components
â”‚   â”‚   â”œâ”€â”€ FormBuilder.jsx    # Main form builder interface
â”‚   â”‚   â”œâ”€â”€ ProjectForms.jsx   # User-facing forms
â”‚   â”‚   â”œâ”€â”€ AdminApp.jsx       # Admin interface wrapper
â”‚   â”‚   â”œâ”€â”€ ThemeProvider.jsx  # Theme management system
â”‚   â”‚   â”œâ”€â”€ ThemeSelector.jsx  # Theme switching component
â”‚   â”‚   â””â”€â”€ api.js            # Forge bridge utilities
â”‚   â”œâ”€â”€ resolvers/            # Backend resolvers
â”‚   â”‚   â”œâ”€â”€ index.js          # Main resolver exports
â”‚   â”‚   â”œâ”€â”€ jiraFields.js     # Jira field discovery
â”‚   â”‚   â”œâ”€â”€ templates.js      # Template management
â”‚   â”‚   â””â”€â”€ issues.js         # Issue creation logic
â”‚   â””â”€â”€ index.js              # Entry point
â”œâ”€â”€ static/                   # Built assets and styles
â”‚   â”œâ”€â”€ styles.css           # Main theme styles
â”‚   â”œâ”€â”€ project-forms/       # Project settings styles
â”‚   â””â”€â”€ bundle.js            # Compiled frontend
â””â”€â”€ manifest.yml             # Forge configuration
            </div>
            
            <h3>ğŸ”„ Data Flow</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>1. Form Building</h4>
                    <p>Admin creates templates â†’ Saves to Forge Storage â†’ Available for projects</p>
                </div>
                <div class="feature-card">
                    <h4>2. Field Discovery</h4>
                    <p>Resolver queries Jira API â†’ Returns available fields â†’ Filtered by project</p>
                </div>
                <div class="feature-card">
                    <h4>3. Issue Creation</h4>
                    <p>User submits form â†’ Validates data â†’ Creates Jira issue â†’ Returns issue key</p>
                </div>
                <div class="feature-card">
                    <h4>4. Theme Management</h4>
                    <p>User selects theme â†’ Stored in localStorage â†’ Applied via CSS classes</p>
                </div>
            </div>
        </section>
        
        <section id="features" class="section">
            <h2>âœ¨ Feature Documentation</h2>
            
            <h3>ğŸ¨ Theme System</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>ğŸŒŸ Ultra Modern (Default)</h4>
                    <p>Clean, professional design with Inter fonts and subtle gradients. Perfect for corporate environments.</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸš€ Sci-Fi Cyber</h4>
                    <p>Futuristic neon aesthetics with Orbitron fonts and glowing effects. Ideal for tech-forward teams.</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ’– Barbie Dream</h4>
                    <p>Vibrant pink theme with Fredoka One fonts. Fun and engaging for creative projects.</p>
                </div>
            </div>
            
            <h3>ğŸ”§ Form Builder Features</h3>
            <div class="code-block">
// Enhanced Field Types (V3)
const fieldTypes = {
  string: 'Text Input',
  textarea: 'Multi-line Text',
  number: 'Number Input with Min/Max',
  select: 'Dropdown Selection',
  multiselect: 'Multiple Choice Checkboxes',
  user: 'User Picker',
  priority: 'Priority Selector',
  date: 'Date Picker (Future)',
  richtext: 'Rich Text Editor (Future)'
};

// Validation Patterns
const validationTypes = {
  email: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
  phone: /^[\+]?[1-9][\d]{0,15}$/,
  url: /^https?:\/\/.+/,
  number: /^\d+$/,
  custom: 'User-defined regex pattern'
};
            </div>
            
            <h3>âš¡ Conditional Logic</h3>
            <div class="highlight">
                <h4>ğŸ¯ Dynamic Field Display</h4>
                <p>Fields can be shown or hidden based on other field values using operators like equals, contains, not_empty, etc.</p>
            </div>
            
            <div class="code-block">
// Conditional Logic Implementation
const shouldShowField = (field) => {
  if (!field.conditionalField) return true;
  
  const dependentValue = formData[field.conditionalField] || '';
  const conditionValue = field.conditionalValue || '';
  
  switch (field.conditionalOperator) {
    case 'equals': return dependentValue === conditionValue;
    case 'not_equals': return dependentValue !== conditionValue;
    case 'contains': return dependentValue.includes(conditionValue);
    case 'not_empty': return dependentValue.trim() !== '';
    case 'empty': return dependentValue.trim() === '';
    default: return true;
  }
};
            </div>
            
            <h3>ğŸ¯ Drag & Drop System</h3>
            <div class="success">
                <h4>âœ… Modern Implementation</h4>
                <p>Uses @dnd-kit/core for smooth, accessible drag-and-drop field reordering with visual feedback.</p>
            </div>
        </section>
        
        <section id="implementation" class="section">
            <h2>ğŸ’» Implementation Guide</h2>
            
            <h3>ğŸš€ Quick Start</h3>
            <div class="code-block">
# 1. Clone and Setup
git clone https://github.com/GeorgeRCAdamJohnson/Form_Build_Forge_App.git
cd Form_Build_Forge_App/formbuilder

# 2. Install Dependencies
npm install

# 3. Build the App
npm run build

# 4. Deploy to Forge
forge deploy
forge install

# 5. Development Mode
forge tunnel
npm run dev
            </div>
            
            <h3>âš™ï¸ Configuration</h3>
            <div class="code-block">
// manifest.yml - Key Configuration
modules:
  jira:adminPage:
    - key: form-builder-admin
      title: Form Builder
      url: /admin
  jira:projectPage:
    - key: custom-forms
      title: Custom Forms
      url: /project-forms

permissions:
  scopes:
    - read:jira-work
    - write:jira-work
    - storage:app
            </div>
            
            <h3>ğŸ”§ Critical Implementation Details</h3>
            
            <div class="warning">
                <h4>âš ï¸ CSP Compliance</h4>
                <p>Forge apps have strict Content Security Policy. All styles must be in CSS files, not inline styles. This was a major learning from development.</p>
            </div>
            
            <div class="code-block">
// âŒ This will cause 403 errors
&lt;div style="color: red;"&gt;Text&lt;/div&gt;

// âœ… Use CSS classes instead
&lt;div className="error-text"&gt;Text&lt;/div&gt;

/* In CSS file */
.error-text { color: red; }
            </div>
            
            <h3>ğŸ“Š Atlassian Document Format</h3>
            <div class="highlight">
                <h4>ğŸ¯ Critical for Jira Integration</h4>
                <p>Jira description fields must use Atlassian Document Format (ADF), not plain text.</p>
            </div>
            
            <div class="code-block">
// Convert plain text to ADF
const convertToADF = (text) => ({
  type: 'doc',
  version: 1,
  content: [{
    type: 'paragraph',
    content: [{
      type: 'text',
      text: text
    }]
  }]
});
            </div>
        </section>
        
        <section id="deployment" class="section">
            <h2>ğŸš€ Deployment Process</h2>
            
            <h3>ğŸ“‹ Pre-Deployment Checklist</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>âœ… Code Quality</h4>
                    <ul>
                        <li>All components use CSS classes (no inline styles)</li>
                        <li>Proper error handling in resolvers</li>
                        <li>Theme consistency across all components</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>âœ… Testing</h4>
                    <ul>
                        <li>Form creation and submission</li>
                        <li>Theme switching functionality</li>
                        <li>Conditional logic behavior</li>
                        <li>Jira issue creation</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>âœ… Performance</h4>
                    <ul>
                        <li>Bundle size optimization</li>
                        <li>Efficient re-renders</li>
                        <li>Proper loading states</li>
                    </ul>
                </div>
            </div>
            
            <h3>ğŸ”„ Deployment Steps</h3>
            <div class="code-block">
# 1. Build Production Bundle
npm run build

# 2. Deploy to Forge Platform
forge deploy

# 3. Install in Jira Instance
forge install --site your-site.atlassian.net

# 4. Verify Installation
# Check: Apps > Manage Apps > Form Builder
# Test: Create a form template
# Test: Submit a form and create issue
            </div>
            
            <div class="success">
                <h4>âœ… Production Ready</h4>
                <p>The app is fully production-ready with real Jira integration, theme persistence, and comprehensive error handling.</p>
            </div>
        </section>
        
        <section id="troubleshooting" class="section">
            <h2>ğŸ”§ Troubleshooting Guide</h2>
            
            <h3>ğŸš¨ Common Issues</h3>
            
            <div class="warning">
                <h4>âŒ 403 CSP Violations</h4>
                <p><strong>Cause:</strong> Inline styles in React components</p>
                <p><strong>Solution:</strong> Move all styles to CSS files and use className</p>
            </div>
            
            <div class="warning">
                <h4>âŒ Issue Creation Fails</h4>
                <p><strong>Cause:</strong> Description field not in ADF format</p>
                <p><strong>Solution:</strong> Convert text to Atlassian Document Format</p>
            </div>
            
            <div class="warning">
                <h4>âŒ Fields Not Loading</h4>
                <p><strong>Cause:</strong> Jira API permissions or project context</p>
                <p><strong>Solution:</strong> Check manifest.yml permissions and project ID</p>
            </div>
            
            <h3>ğŸ” Debugging Tips</h3>
            <div class="code-block">
// Enable detailed logging
console.log('Resolver called with:', args);
console.log('Jira response:', response);

// Check Forge tunnel logs
forge tunnel --verbose

// Verify permissions in manifest.yml
permissions:
  scopes:
    - read:jira-work
    - write:jira-work
    - storage:app
            </div>
            
            <h3>âš¡ Performance Optimization</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>ğŸ¯ Bundle Size</h4>
                    <p>Keep dependencies minimal. The app uses only essential libraries for maximum performance.</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ”„ Re-renders</h4>
                    <p>Use React.memo and useCallback for expensive operations like field validation.</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ’¾ Storage</h4>
                    <p>Forge Storage has limits. Optimize template data structure for efficiency.</p>
                </div>
            </div>
        </section>
        
        <section id="lessons" class="section">
            <h2>ğŸ“š Lessons Learned</h2>
            
            <h3>âœ… What Worked Well</h3>
            <div class="success">
                <h4>ğŸ¨ Theme System Architecture</h4>
                <p>CSS custom properties with theme classes provided excellent maintainability and consistency across all components.</p>
            </div>
            
            <div class="success">
                <h4>ğŸ”§ @dnd-kit Implementation</h4>
                <p>Modern drag-and-drop library provided smooth, accessible interactions with minimal setup complexity.</p>
            </div>
            
            <div class="success">
                <h4>ğŸ“Š Forge Storage Integration</h4>
                <p>Simple key-value storage worked perfectly for template persistence with automatic serialization.</p>
            </div>
            
            <h3>âš ï¸ Challenges Overcome</h3>
            <div class="warning">
                <h4>ğŸš« CSP Compliance</h4>
                <p>Strict Content Security Policy required complete elimination of inline styles. Solution: Comprehensive CSS class system.</p>
            </div>
            
            <div class="warning">
                <h4>ğŸ“ Atlassian Document Format</h4>
                <p>Jira API requires specific ADF structure for rich text fields. Solution: Text-to-ADF conversion utility.</p>
            </div>
            
            <div class="warning">
                <h4>ğŸ”„ State Management</h4>
                <p>Complex form state with conditional logic required careful state structure. Solution: Flat state with computed visibility.</p>
            </div>
            
            <h3>ğŸš€ Future Enhancements</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>ğŸ“ Rich Text Editor</h4>
                    <p>Implement ADF-native rich text editing for description fields</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ“ File Upload</h4>
                    <p>Add file attachment support with Jira attachment API</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ”— Workflow Integration</h4>
                    <p>Deep integration with Jira workflows and automation</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ“Š Analytics Dashboard</h4>
                    <p>Form usage analytics and submission tracking</p>
                </div>
            </div>
        </section>
        
        <div class="section" style="text-align: center; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white;">
            <h2>ğŸ‰ Ready for Production!</h2>
            <p style="font-size: 1.2rem; margin-bottom: 0;">Your Forge Form Builder is fully functional and ready to transform how your team creates Jira issues.</p>
        </div>
    </div>
</body>
</html>